{% extends "../main.html" %}

{% block title %}User Index{% end %}

{% block content %}
	<script>
	$(document).ready(function() {
        var ws = new WebSocket("ws://{{ handler.application.settings['ws_ip_address'] }}:{{ handler.application.settings['ws_port'] }}/notifications");
	    ws.onmessage = function (evt) {
	    	notification = jQuery.parseJSON(evt.data);
	        if(notification['category'] == 'success') {
	        	Notifier.success(notification['message'], notification['title']);
	        } else if (notification['category'] == 'info') {
	        	Notifier.info(notification['message'], notification['title']);
	        } else if (notification['category'] == 'warning') {
	        	Notifier.warning(notification['message'], notification['title']);
	        } else if (notification['category'] == 'error') {
	        	Notifier.error(notification['message'], notification['title']);
	        } else if (notification['category'] == 'custom') {
	        	Notifier.notify(notification['message'], notification['title'], notification['icon_url']);
	        }
	    };
    });
	</script>
	<div class="row">
		<div class="span4 well">
			<h2>{{ user.handle }}</h2>
			<img src="/avatars/{{ user.avatar }}" />
		</div>
		<div class="span7 well">
			<h2>Notifications</h2>
			{% from models import Notification %}
			{% for notify in Notification.by_user_id(user.id) %}
				<div class="well">
					{{ notify.title }}:{{ notify.message }}
				</div>
			{% end %}
		</div>
	</div>
{% end %}