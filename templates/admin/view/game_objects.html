{% extends "../../main.html" %}

{% block title %}Game Objects{% end %}

{% block content %}
    <!-- Edit Corporation -->
    <div id="editCorporationModal" class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Edit Corporation</h3>
        </div>
        <div class="modal-body">
            <form class="form-horizontal" id="edit-corporation" method="post" action="/admin/edit/corporation">
                {% raw xsrf_form_html() %}
                <input id="corporation_uuid" name="uuid" value="" type="hidden" />
                <div class="control-group">
                    <label class="control-label" for="corporation_name">Name</label>
                    <div class="controls">
                        <input id="corporation_name" name="name" type="text" placeholder="Corporation Name" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="corporation_description">Description</label>
                    <div class="controls">
                        <input id="corporation_description" name="description" type="text" placeholder="Description" />
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button class="btn btn-primary" type="button" onclick="document.forms['edit-corporation'].submit();">Save</button>
        </div>
    </div>
    <!-- Edit Box -->
    <div id="editBoxModal" class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Edit Box</h3>
        </div>
        <div class="modal-body">
            <form id="edit-box" method="post" action="/admin/edit/box">
                {% raw xsrf_form_html() %}
                <input id="box_uuid" name="uuid" value="" type="hidden" />
                <div class="control-group">
                    <label class="control-label" for="box_name">Box Name</label>
                    <div class="controls">
                        <input id="box_name" name="name" type="text" placeholder="Box Name" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="box_corporation">Corporation</label>
                    <div class="controls">
                        <select id="box_corporation" name="corporation_uuid">
                            {% from models import Corporation %}
                            {% for corporation in Corporation.all() %}
                                <option value="{{ corporation.uuid }}">{{ corporation.name }}</option>
                            {% end %}
                        </select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="box_game_level">Game Level</label>
                    <div class="controls">
                        <select id="box_game_level" name="game_level_uuid">
                            {% from models import GameLevel %}
                            {% for level in GameLevel.all() %}
                                <option value="{{ level.uuid }}">{{ level.number }}</option>
                            {% end %}
                        </select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="box_description">Description</label>
                    <div class="controls">
                        <input id="box_description" name="description" type="text" placeholder="Description" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="box_difficulty">Difficulty</label>
                    <div class="controls">
                        <input id="box_difficulty" name="difficulty" type="text" placeholder="Difficutly Rating" />
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="button" class="btn btn-primary" onclick="document.forms['edit-box'].submit();">Save</button>
        </div>
    </div>
    <!-- Edit Flag -->
    <div id="editFlagModal" class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Edit Flag</h3>
        </div>
        <div class="modal-body">
            <form id="edit-flag" method="post" action="/admin/edit/flag">
                {% raw xsrf_form_html() %}
                <input id="flag_uuid" name="uuid" type="hidden" />
                <div class="control-group">
                    <label class="control-label" for="flag_name">Name</label>
                    <div class="controls">
                        <input id="flag_name" name="name" type="text" placeholder="Flag Name" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="flag_token">Token</label>
                    <div class="controls">
                        <input id="flag_token" name="token" type="text" placeholder="Token Value" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="flag_description">Description</label>
                    <div class="controls">
                        <input id="flag_description" name="description" type="text" placeholder="Description" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="flag_value">Value</label>
                    <div class="controls">
                        <input id="flag_value" name="value" type="text" placeholder="($) Reward Value" />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="flag_box_uuid">Box</label>
                    <div class="controls">
                        <select id="flag_box_uuid" name="box_uuid">
                            {% from models import Box %}
                            {% for box in Box.all() %}
                                <option value="{{ box.uuid }}">{{ box.name }}</option>
                            {% end %}
                        </select>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="button" class="btn btn-primary" onclick="document.forms['edit-flag'].submit();">Save</button>
        </div>
    </div>
    <!-- Add Ipv4 -->
    <div class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Add IPv4 Address</h3>
        </div>
        <div class="modal-body">
        <form id="add-ipv4" method="post" action="/admin/edit/ipv4">
            {% raw xsrf_form_html() %}
            <input name="ipv4" type="text" placeholder="IPv4 Address" />
        </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="button" class="btn btn-primary">Add</button>
        </div>
    </div>
    <!-- Add Ipv6 -->
    <div class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Add IPv6 Address</h3>
        </div>
        <div class="modal-body">
        <form id="add-ipv6" method="post" action="/admin/edit/ipv6">
            {% raw xsrf_form_html() %}
            <input name="ipv6" type="text" placeholder="IPv6 Address" />
        </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="button" class="btn btn-primary">Add</button>
        </div>
    </div>
    <!-- Del Ip -->
    <div id="delIp" class="modal hide fade" style="display: none; ">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Delete IP Address</h3>
        </div>
        <div class="modal-body">
        <p>
            Are you sure you want to delete this IP address? <br />
        </p>
        <form id="add-ipv6" method="post" action="/admin/edit/ipv6">
            {% raw xsrf_form_html() %}
            <input name="ip" type="hidden" value="__blank__" />
        </form>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Close</a>
            <button type="button" class="btn btn-danger">Delete</button>
        </div>
    </div>
    <script>
        function get_details(obj, uuid) {
            $("#" + obj + "_uuid").val(uuid);
            $.getJSON('/admin/ajax/objects?uuid=' + uuid + '&obj=' + obj, function(data) {
                $.each(data, function(key, value) {
                    console.log("#" + obj + "_" + key + " -> " + value);
                    $("#" + obj + "_" + key).val(value);
                });
            });
        }
    </script>
    <!-- Start Visable -->
    <div class="row-fluid">
        <div class="span2" />
            <ul class="nav nav-tabs nav-stacked affix">
                {% for corporation in Corporation.all() %}
                    <li><a href="#{{ corporation.uuid }}"><i class="icon-chevron-right"></i>{{ corporation.name }}</a></li>
                {% end %}
            </ul>
        </div>
        <div class="span10">
            <h1>Game Objects</h1>
            <br />
            {% if errors != None and len(errors) != 0 %}
                {% for error in errors %}
                    <div class="alert alert-error">
                        <a class="close" data-dismiss="alert" href="#">×</a>
                        <h4 class="alert-heading">ERROR</h4>
                        {{ error }}
                    </div>
                {% end %}
            {% end %}
            {% for corporation in Corporation.all() %}
                <div id="{{ corporation.uuid }}" class="well">
                    <h2 style="display:inline;">{{ corporation.name }}&nbsp;&nbsp;</h2>
                    <a class="btn btn-small" data-toggle="modal" href="#editCorporationModal" 
                        onclick="get_details('corporation', '{{ corporation.uuid }}')">
                        Edit Corp
                    </a>
                    <br />
                    <br />
                    {% for box in corporation.boxes %}
                        <div class="well">
                            <h3 style="display:inline;">{{ box.name }}&nbsp;&nbsp;</h3>
                                <a class="btn btn-small" data-toggle="modal" href="#editBoxModal"
                                    onclick="get_details('box', '{{ box.uuid }}')">
                                    Edit Box
                                </a>
                            <br />
                            <br />
                            <div class="row-fluid">
                                <div class="well span4">
                                    <h4 style="display:inline;">IPv4 Addresses&nbsp;&nbsp;</h4>
                                    <a class="btn btn-small" data-toggle="modal" href="#editIpv4">
                                        Add IPv4
                                    </a>
                                    <br />
                                    <hr>
                                    {% if len(box.ipv4) != 0 %}
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>IPv4 Address</th>
                                                    <th><!-- Delete --></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for ip in box.ipv4 %}
                                                    <tr>
                                                        <td>{{ box.ipv4.index(ip) + 1}}</td>
                                                        <td>{{ ip }}</td>
                                                        <td>
                                                            <a class="btn btn-danger btn-mini" data-toggle="modal" href="#delIp">
                                                                Delete
                                                            </a>
                                                        </td>
                                                    </tr>
                                                {% end %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <strong>No IPv4 Addresses</strong>
                                    {% end %}
                                </div>
                                <div class="well span4">
                                    <h4 style="display:inline;">IPv6 Addresses&nbsp;&nbsp;</h4>
                                    <a class="btn btn-small" data-toggle="modal" href="#editIpv6">
                                        Add IPv6
                                    </a>
                                    <br />
                                    <hr>
                                    {% if len(box.ipv6) != 0 %}
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>IPv6 Address</th>
                                                    <th><!-- Delete --></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for ip in box.ipv6 %}
                                                    <tr>
                                                        <td>{{ box.ipv6.index(ip) + 1 }}</td>
                                                        <td>{{ ip }}</td>
                                                        <td>
                                                            <a class="btn btn-danger btn-mini" data-toggle="modal" href="#delIp">
                                                                Delete
                                                            </a>
                                                        </td>
                                                    </tr>
                                                {% end %}
                                            </tbody>
                                        </table>
                                    {% else %}
                                        <strong>No IPv6 Addresses</strong>
                                    {% end %}
                                </div>
                            </div>
                            <div class="well">
                                <h4>Flags on {{ box.name }}</h4>
                                <hr>
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Token</th>
                                            <th>Value</th>
                                            <th><!-- Edit Button --></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for flag in box.flags %}
                                            <tr>
                                                <td>{{ box.flags.index(flag) + 1 }}</td>
                                                <td>{{ flag.name }}</td>
                                                <td>{{ flag.description }}</td>
                                                <td>{{ flag.token }}</td>
                                                <td>${{ flag.value }}</td>
                                                <td>
                                                    <a class="btn btn-mini" data-toggle="modal" href="#editFlagModal"
                                                        onclick="get_details('flag', '{{ flag.uuid }}')">
                                                        Edit Flag
                                                    </a>
                                                </td>
                                            </tr>
                                        {% end %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <br />
                    {% end %}
                </div>
            {% end %}
        </div>
    </div>
{% end %}